<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Modifying and saving the models · COBREXA.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="COBREXA.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="COBREXA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">COBREXA.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">User guide</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox" checked/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Quickstart tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../">All tutorials</a></li><li><a class="tocitem" href="../1_loading/">Loading and converting model data</a></li><li><a class="tocitem" href="../2_analysis/">Basic analysis of constraint-based models</a></li><li><a class="tocitem" href="../3_hpc/">Distributed processing and HPC environments</a></li><li class="is-active"><a class="tocitem" href>Modifying and saving the models</a><ul class="internal"><li><a class="tocitem" href="#Manual-modifications"><span>Manual modifications</span></a></li><li><a class="tocitem" href="#Analysis-modifiers"><span>Analysis modifiers</span></a></li><li><a class="tocitem" href="#Exporting-the-modified-models-in-native-formats"><span>Exporting the modified models in native formats</span></a></li><li><a class="tocitem" href="#Using-Serialization-for-quick-and-efficient-model-storage"><span>Using <code>Serialization</code> for quick &amp; efficient model storage</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Advanced tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../advanced/">All advanced tutorials</a></li><li><a class="tocitem" href="../../advanced/1_variants/">Exploring many model variants</a></li><li><a class="tocitem" href="../../advanced/2_custom_model/">Working with custom models</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Examples and notebooks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../notebooks/">All notebooks</a></li><li><a class="tocitem" href="../../notebooks/1_loading_converting_saving/">Loading, converting, and saving models</a></li><li><a class="tocitem" href="../../notebooks/2_finding_balance/">Finding balance and variability of constraint-based models</a></li><li><a class="tocitem" href="../../notebooks/3_basic_stdmodel_usage/">Basic usage of <code>StandardModel</code></a></li><li><a class="tocitem" href="../../notebooks/4_basic_core_coupled_usage/">Basic usage of <code>CoreModel</code> and <code>CoreModelCoupled</code></a></li><li><a class="tocitem" href="../../notebooks/5_basic_stdmodel_construction/">Model construction and modification</a></li><li><a class="tocitem" href="../../notebooks/6_screening/">Exploring model variants with <code>screen</code></a></li><li><a class="tocitem" href="../../notebooks/7_community_model/">Building and analysing a small community model</a></li><li><a class="tocitem" href="../../notebooks/8_custom_model/">Using a custom model data structure</a></li><li><a class="tocitem" href="../../notebooks/9_max_min_driving_force_analysis/">Maximum-minimum driving force analysis</a></li></ul></li></ul></li><li><span class="tocitem">Types and functions</span><ul><li><a class="tocitem" href="../../functions/">Contents</a></li><li><a class="tocitem" href="../../functions/analysis/">Analysis functions</a></li><li><a class="tocitem" href="../../functions/base/">Base functions</a></li><li><a class="tocitem" href="../../functions/io/">Input and output</a></li><li><a class="tocitem" href="../../functions/reconstruction/">Model construction functions</a></li><li><a class="tocitem" href="../../functions/types/">Types</a></li><li><a class="tocitem" href="../../functions/utils/">Utilities</a></li></ul></li><li><a class="tocitem" href="../../howToContribute/">How to contribute</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User guide</a></li><li><a class="is-disabled">Quickstart tutorials</a></li><li class="is-active"><a href>Modifying and saving the models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Modifying and saving the models</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/lcsb-biocore/COBREXA.jl/blob/master/docs/src/tutorials/4_modifying.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Modifying-and-saving-the-models"><a class="docs-heading-anchor" href="#Modifying-and-saving-the-models">Modifying and saving the models</a><a id="Modifying-and-saving-the-models-1"></a><a class="docs-heading-anchor-permalink" href="#Modifying-and-saving-the-models" title="Permalink"></a></h1><p>Making a small modification to the model and reanalyzing them is often a useful way to explore how the constraints work together, and to inspect the degrees of freedom in the model.</p><p>With <code>COBREXA.jl</code>, you have two main choices of making model modifications:</p><ul><li>you can manually change the model structures (i.e. permanently change the data in of your <code>model</code> variable)</li><li>you can use special arguments of analysis functions that allow you to make the modifications in a declarative way and &quot;on the fly&quot;, without having to manually interact with the model</li></ul><div class="admonition is-success"><header class="admonition-header">Notebook available</header><div class="admonition-body"><p>The available notebooks demonstrate <a href="../../notebooks/1_loading_converting_saving/">model export and serialization</a> and various model modifications (<a href="../../notebooks/3_basic_stdmodel_usage/">1</a>, <a href="../../notebooks/4_basic_core_coupled_usage/">2</a>, <a href="../../notebooks/5_basic_stdmodel_construction/">3</a>).</p></div></div><h2 id="Manual-modifications"><a class="docs-heading-anchor" href="#Manual-modifications">Manual modifications</a><a id="Manual-modifications-1"></a><a class="docs-heading-anchor-permalink" href="#Manual-modifications" title="Permalink"></a></h2><p>Certain model types, including <a href="../../functions/types/#COBREXA.CoreModel"><code>CoreModel</code></a> and <a href="../../functions/types/#COBREXA.StandardModel"><code>StandardModel</code></a>, are built from mutable <code>structs</code> that you are free to modify as you want.</p><p><a href="../../functions/types/#COBREXA.CoreModel"><code>CoreModel</code></a> consists of sparse matrices and vectors that describe the model precisely. For example, modifying a bound of the reaction is as simple as writing to the <code>.xl</code> or <code>.xu</code> (<strong>l</strong>ower and <strong>u</strong>pper bound for <strong>x</strong>) vectors in the structure:</p><pre><code class="language-none">using COBREXA
m = load_model(CoreModel, &quot;e_coli_core.xml&quot;)
m.xl[3] = 0.0</code></pre><p>The available field names can be listed using e.g. <code>fieldnames(CoreModel)</code>, or more conveniently by employing the completion in the shell:</p><pre><code class="language-none">julia&gt; m.   # press [Tab]
S    b     c     mets  rxns  xl    xu</code></pre><p>With <code>CoreModel</code>, you may need to find the proper metabolites by identifier. For that, you may examine the <a href="../../functions/types/#COBREXA.reactions-Tuple{CoreModel}"><code>reactions</code></a> and <a href="../../functions/types/#COBREXA.metabolites-Tuple{CoreModel}"><code>metabolites</code></a> of the model, e.g. using</p><pre><code class="language-none">indexin([&quot;M_nadh_c&quot;, &quot;M_co2_e&quot;], metabolites(m))</code></pre><p>...which will return the numeric indexes of NADH and CO₂ metabolites. These can be used to, e.g., change the &quot;balance&quot; of the metabolites in the model:</p><pre><code class="language-none">m.b[64] = -1      # model will be losing 1 flux unit of CO₂</code></pre><p>...or to modify existing reaction (here with index 5) directly in stoichiometry matrix:</p><pre><code class="language-none">m.S[5,8] = -1
m.S[5,64] = 1</code></pre><p>While this works well if you are used to working with matrix-like representations of the model, it is not really convenient if you want to change the reactions and models in an easy way. <a href="../../functions/types/#COBREXA.StandardModel"><code>StandardModel</code></a> is structured in a much more user-friendly way, which makes the manual modifications easier.</p><p>In particular, <a href="../../functions/types/#COBREXA.StandardModel"><code>StandardModel</code></a> consists of dictionaries of <a href="../../functions/types/#COBREXA.Reaction"><code>Reaction</code></a>, <a href="../../functions/types/#COBREXA.Metabolite"><code>Metabolite</code></a> and <a href="../../functions/types/#COBREXA.Gene"><code>Gene</code></a> objects that may be modified and indexed directly using their names. That way, the above modifications may be written in a cleaner, semantic and declarative fashion, as follows:</p><pre><code class="language-none">m = load_model(StandardModel, &quot;e_coli_core.xml&quot;)
m.reactions[&quot;R_TPI&quot;].lb = 0.0                         # change lower bound of the reaction to 0
m.reactions[&quot;R_GLNS&quot;].metabolites[&quot;M_nadh_c&quot;] = -1.0  # update stoichiometry
m.reactions[&quot;R_GLNS&quot;].metabolites[&quot;M_co2_e&quot;] = 1.0
...</code></pre><p>There are other functions that may be used to change the <code>StandardModel</code> in a more systematic way. See the documentation of <a href="../../functions/reconstruction/#COBREXA.add_reaction!-Tuple{CoreModel, Reaction}"><code>add_reaction!</code></a>, <a href="../../functions/reconstruction/#COBREXA.add_metabolite!-Tuple{StandardModel, Metabolite}"><code>add_metabolite!</code></a>, <a href="../../functions/reconstruction/#COBREXA.add_gene!-Tuple{StandardModel, Gene}"><code>add_gene!</code></a>, <a href="../../functions/reconstruction/#COBREXA.remove_reaction!-Tuple{CoreModel, Int64}"><code>remove_reaction!</code></a>, <a href="../../functions/reconstruction/#COBREXA.remove_metabolite!-Tuple{CoreModel, Int64}"><code>remove_metabolite!</code></a>, [ <a href="../../functions/reconstruction/#COBREXA.remove_gene!-Tuple{StandardModel, String}"><code>remove_gene!</code></a>, and the <a href="../../functions/reconstruction/#Model-construction-functions">Model construction functions</a> reference section for more examples.</p><h2 id="Analysis-modifiers"><a class="docs-heading-anchor" href="#Analysis-modifiers">Analysis modifiers</a><a id="Analysis-modifiers-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis-modifiers" title="Permalink"></a></h2><p>Some analysis functions, including <a href="../../functions/analysis/#COBREXA.flux_balance_analysis-Union{Tuple{M}, Tuple{M, Any}} where M&lt;:MetabolicModel"><code>flux_balance_analysis</code></a> and <a href="../../functions/analysis/#COBREXA.flux_variability_analysis-Tuple{MetabolicModel, Any}"><code>flux_variability_analysis</code></a>, accept a special argument <code>modifications</code>, which is a list of descriptions of small changes that should be applied to the model before modification.</p><p>These include:</p><ul><li><a href="../../functions/analysis/#COBREXA.change_objective-Tuple{Union{String, Vector{String}}}"><code>change_objective</code></a> that sets a new optimization objective</li><li><a href="../../functions/analysis/#COBREXA.change_optimizer-Tuple{Any}"><code>change_optimizer</code></a> that chooses a different <code>JuMP.jl</code> optimizer for the analysis</li><li><a href="../../functions/analysis/#COBREXA.change_optimizer_attribute-Tuple{Any, Any}"><code>change_optimizer_attribute</code></a> that can set various optimizer parameters</li><li><a href="../../functions/analysis/#COBREXA.change_constraint-Tuple{String}"><code>change_constraint</code></a> that changes the flux bounds of a reaction</li><li><a href="../../functions/analysis/#COBREXA.knockout-Tuple{String}"><code>knockout</code></a> that disables reactions that depend on genes</li><li><a href="../../functions/analysis/#COBREXA.add_crowding_constraints-Tuple{Dict{Int64, Float64}}"><code>add_crowding_constraints</code></a> that adds crowding constraints to the model</li><li><a href="../../functions/analysis/#COBREXA.add_moment_constraints-Tuple{Dict{String, Float64}, Float64}"><code>add_moment_constraints</code></a> that adds moment constraints to the model</li><li><a href="../../functions/analysis/#COBREXA.add_loopless_constraints-Tuple{}"><code>add_loopless_constraints</code></a> that adds loopless (thermodynamic) constraints to the model</li></ul><p>This way, you can easily check out the model state when maximizing the rate of &quot;TALA&quot; (transadenolase A) reaction:</p><pre><code class="language-none">m = load_model(StandardModel, &quot;e_coli_core.xml&quot;)
flux_balance_analysis_dict(
  m, GLPK.Optimizer;
  modifications=[change_objective(&quot;R_TALA&quot;)])</code></pre><p>...or knock out a gene combination that disables the transadenolase A completely (see <code>m.reactions[&quot;R_TALA&quot;].grr</code>):</p><pre><code class="language-none">flux_balance_analysis_dict(
  m, GLPK.Optimizer;
  modifications=[knockout([&quot;G_b0008&quot;, &quot;G_b2464&quot;])])</code></pre><p>...or do both at once– knock out some other genes, and try to maximize the transadenolase A reaction rate:</p><pre><code class="language-none">flux_balance_analysis_dict(
  m, GLPK.Optimizer;
  modifications=[
    knockout([&quot;G_s0001&quot;]),
    change_objective(&quot;R_TALA&quot;),
  ])</code></pre><h2 id="Exporting-the-modified-models-in-native-formats"><a class="docs-heading-anchor" href="#Exporting-the-modified-models-in-native-formats">Exporting the modified models in native formats</a><a id="Exporting-the-modified-models-in-native-formats-1"></a><a class="docs-heading-anchor-permalink" href="#Exporting-the-modified-models-in-native-formats" title="Permalink"></a></h2><p>Manually modified models can be exported in standard formats so that they can be examined in other environments, or just made accessible for publication.</p><p><code>COBREXA.jl</code> supports export of MATLAB-like and JSON models. Simply use <a href="../../functions/io/#COBREXA.save_model-Tuple{MetabolicModel, String}"><code>save_model</code></a>:</p><pre><code class="language-none">save_model(m, &quot;myModel.json&quot;)
save_model(m, &quot;myModel.mat&quot;)</code></pre><p>The function automatically guesses the appropriate model format to write into the file from the file extension. If required, you can choose the model format manually by using <a href="../../functions/io/#COBREXA.save_json_model-Tuple{MetabolicModel, String}"><code>save_json_model</code></a> and <a href="../../functions/io/#COBREXA.save_mat_model-Tuple{MetabolicModel, String}"><code>save_mat_model</code></a>.</p><h2 id="Using-Serialization-for-quick-and-efficient-model-storage"><a class="docs-heading-anchor" href="#Using-Serialization-for-quick-and-efficient-model-storage">Using <code>Serialization</code> for quick &amp; efficient model storage</a><a id="Using-Serialization-for-quick-and-efficient-model-storage-1"></a><a class="docs-heading-anchor-permalink" href="#Using-Serialization-for-quick-and-efficient-model-storage" title="Permalink"></a></h2><p>If you save the model &quot;just for yourself&quot;, such as for the use in an immediately following analysis, it may be inconvenient (and unnecessarily inefficient) to encode and decode the models to and from the external format. Moreover, certain model types (such as <a href="../../functions/types/#COBREXA.CoreModelCoupled"><code>CoreModelCoupled</code></a>) cannot be fully represented in all model formats, thus increasing the chance for accidental data loss.</p><p>Instead of that, we recommend using the <code>Serialization</code> package. It provides a straightforward way to save <em>any</em> Julia data structure to the disk, using a very efficient data format that can be written to and read from the disk very quickly.</p><p>With any model in <code>m</code>, you can write it to disk as follows:</p><pre><code class="language-none">using Serialization
open(f -&gt; serialize(f, m), &quot;myModel&quot;, &quot;w&quot;)</code></pre><p>...and read it back with:</p><pre><code class="language-none">m = deserialize(&quot;myModel&quot;)</code></pre><p>One great advantage of <code>Serialization</code> is speed – models with millions of reactions are usually loaded and saved with minimal overhead in less than a second.</p><div class="admonition is-warning"><header class="admonition-header">Limits of `Serialization`</header><div class="admonition-body"><p>Serialized models are great for quickly exchanging data objects between analysis steps. The avoided need for re-encoding can save you a great deal of analysis time that can be used for better purposes. Despite that, do not rely on the stability of the serialized format – it often changes between Julia versions, and the data stored in one version may not open easily after an upgrade. In short, use serialized data within one workflow, and use standard and stable external formats for publishing and storing the data beyond the scope of a single analysis workflow.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../3_hpc/">« Distributed processing and HPC environments</a><a class="docs-footer-nextpage" href="../../advanced/">All advanced tutorials »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 27 April 2022 18:49">Wednesday 27 April 2022</span>. Using Julia version 1.7.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
